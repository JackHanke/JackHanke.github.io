---
layout: post
title:  "An Exact Formula for the Board Game RISK"
date:   2025-01-23 19:58:34 -0600
categories: jekyll update
---

[GitHub Repo ðŸ‘¾](https://github.com/JackHanke/risk) | [YouTube Video ðŸ“º](https://www.youtube.com/watch?v=U442pGuUVhY)

## A Classic Boardgame Question

The board game [RISK](https://en.wikipedia.org/wiki/Risk_(game)) has reigned as one of the most popular board games of all time since its introduction in 1957. 

In the game, combat occurs between two countries with a number of attacking troops $a$ and a number of defending troops $b$. The rules of combat and empirical data on the probability an attacking force $a$ wins was shown by the authors of the [DataGenetics](http://datagenetics.com/blog/november22011/index.html) blog. 

Let $t(a,b)$ represent this success probability. The main result of this project is the RISK recurrence, shown below. 

| Domain | Relation |
| $a=0,b \geq 0$ | $t(0,b) = 0$ |
| $a=1,b \geq 0$ | $t(1,b) = 0$ |
| $a \geq 2,b=0$ | $t(a,0) = 1$ |
| $a=2,b \geq 1$ | $t(2,b) = \left(\frac{55}{216}\right)^{b-1}\left(\frac{15}{36}\right)$ |
| $a \geq 3,b=1$ | $t(a,1) = 1 - \left(\frac{441}{1296}\right)^{a-3}\left(\frac{91}{216}\right)\left(\frac{21}{36}\right)$ |
| $a=3,b \geq 2$ | $t(3,b) = \frac{295}{1296}t(3,b-2) + \left(\frac{55}{216}\right)^{b-2}\left(\frac{420}{1296}\right)\left(\frac{15}{36}\right)$ |
| $a \geq 4,b \geq 2$ | $t(a,b) = \frac{2890}{7776}t(a,b-2) + \frac{2611}{7776}t(a-1,b-1) + \frac{2275}{7776}t(a-2,b)$ |

This recurrence can be used to compute any reasonable values of $t(a,b)$ very quickly. A simple Python implementation of this can be found [here](https://github.com/JackHanke/risk/blob/main/risk.py). 

## An Academic Exercise

This recurrence is linear, and so can be solved exactly using multivariate generating functions. It is important to point out that the Theorems 1 and 2 are only useful as academic exercises, as the complexity and computational cost of these results make their use unfeasible. However, I am still happy to report that one can symbolically write such a probability, no matter how complicated. 

Implementations of the following two theorems can be found [here](https://github.com/JackHanke/risk/blob/main/risky.ipynb).

**Theorem 1.** Let

$$T(x,y) = \sum_{a,b \geq 0}t(a,b)x^a y^b = \frac{x^{2}P(x,y)}{Q(x,y)}.$$

where

$Q(x,y) = 36 (x - 1)(49 x - 144)(55 y - 216)(295 y^{2} - 1296)(2275 x^{2} + 2611 x y + 2890 y^{2} - 7776)$

and the numerator $P(x,y)$ can be found in the `risk.pdf` summary [here](https://github.com/JackHanke/risk/blob/main/writeup/risk.pdf).

**Proof** The proof, though tedioius, is a straightforward application of generating functions. This computation was completed with the assistance of [SageMath](https://www.sagemath.org/).

And because the generating function is rational, it is possible to exactly solve $t(a,b)$. This result is ridiculous, but does count as exact enumeration. 

**Theorem 2.**

Define $T(x,y) = T_1(x,y) + T_2(x,y) + T_3(x,y) + T_4(x,y) + T_5(x,y)$, where $T_i$ is defined by the following.

$$ T_1(x,y) = -x^2\left(\frac{7776 + 7776x + 3240y + 3254xy}{(7776 - 2275x^2 - 2611xy - 2890y^2)}\right) $$

$$ T_2(x,y) = x^2\left(\frac{7776-2611xy-2275x^2}{(1-x)(7776 - 2275x^2 - 2611xy - 2890y^2)}\right) $$

$$ T_3(x,y) = x^2\left(\frac{7776+1260y-2611xy-2890y^2-\frac{91385}{216}xy^2 - \frac{50575}{108}y^3}{(1-\frac{55}{216}y)(7776 - 2275x^2 - 2611xy - 2890y^2)}\right) $$

$$ T_4(x,y) = x^2\left(\frac{3240y + \frac{3045}{2} xy - \frac{6965}{12} x^{2} y - \frac{2309125}{5184} x^{3} y - \frac{557375}{5184} x^{4} y}{(1-\frac{49}{144}x)(1-x)(7776 - 2275x^2 - 2611xy - 2890y^2)}\right) $$

$$ T_5(x,y) = x^2\left(\frac{7776 x + 3885 x y - \frac{240005}{72} x y^{2} - \frac{1871275}{1296} x y^{3} + \frac{46131625}{279936} x y^{4}}{(1-\frac{55}{216}y)(1-\frac{295}{1296}y^2)(7776 - 2275x^2 - 2611xy - 2890y^2)}\right) $$

Now we define the following notation to solve the generating function.

$$F(x,y) = \frac{1}{7776-2275x^2-2611xy-2890y^2}$$

This function has coefficients 

$$ t_1(a,b) = F(x,y)[x^a][y^b] = \frac{1}{7776} \left(\frac{2275}{7776}\right)^{\frac{a}{2}} \left(\frac{2890}{7776}\right)^{\frac{b}{2}} \sum_{j=0}^{\frac{a+b}{2}}\binom{\frac{a+b}{2}}{\frac{a-b}{2}+2j}\binom{\frac{a-b}{2}+2j}{j}\left(\frac{2611}{85\sqrt{910}}\right)^{b-2j} $$

for even $a+b$ and $0$ otherwise. We then similarly define

$$ t_2(a,b) = \frac{1}{(1-x)}F(x,y)[x^a][y^b] = \sum_{i=0}^a t_1(i,b) $$

$$ t_3(a,b) = \frac{1}{(1-\frac{55}{216}y)}F(x,y)[x^a][y^b] = \sum_{j=0}^b t_1(a,j)\left(\frac{55}{216}\right)^{b-j} $$

$$ t_4(a,b) =\frac{1}{(1-x)(1-\frac{49}{144}x)}F(x,y)[x^a][y^b] = \sum_{i_2=0}^a\sum_{i_1=0}^{i_2} t_1(i_1,b)\left(\frac{49}{144}\right)^{i_2-i_1} $$

$$\begin{eqnarray*}
t_5(a,b) & = & \frac{1}{(1-\frac{55}{216}y)(1-\frac{295}{1296}y^2)}F(x,y)[x^a][y^b] \\
         & = & \frac{1}{2} \sum_{i_2=0}^b\sum_{i_1=0}^{i_2} t_1(a,i_1)\left(\frac{55}{216}\right)^{b-i_2} \left(\left(\sqrt{\frac{295}{1296}}\right)^{i_2-i_1} + \left(-\sqrt{\frac{295}{1296}}\right)^{i_2-i_1}\right)
\end{eqnarray*}$$

Finally, we have

$$\begin{eqnarray*}
t(a+2,b) & = & -7776 t_1(a,b) - 7776t_1(a-1,b) - 3240 t_1(a,b-1) - 3254 t_1(a-1,b-1) \\
& & {} + 7776 t_2(a,b) - 2611 t_2(a-1,b-1) - 2275 t_2(a-2,b) \\
& & {} + 7776 t_3(a,b) + 1260 t_3(a,b-1) -2611 t_3(a-1,b-1) - 2890 t_3(a,b-2) \\
& & {} - \frac{91385}{216} t_3(a-1,b-2) - \frac{50575}{108}t_3(a,b-3) \\
& & {} + 3240 t_4(a,b-1) + \frac{3045}{2}t_4(a-1,b-1) -  \frac{6965}{12} t_4(a-2,b-1) \\
& & {} - \frac{2309125}{5184}t_4(a-3,b-1) -\frac{557375}{5184}t_4(a-4,b-1) \\
& & {} + 7776 t_5(a-1,b) + 3885 t_5(a-1,b-1) - \frac{240005}{72} t_5(a-1,b-2) \\
& & {} - \frac{1871275}{1296} t_5(a-1,b-3) + \frac{46131625}{279936} t_5(a-1,b-4) 
\end{eqnarray*}$$

**Proof** This proof is also extremely tedious and was completed with the assistance of SageMath. 

## An Even Further Afeild Academic Exercise

After completing this project, I had the nagging question of whether the partial recurrence relation 

$$f(x,y) = \alpha f(x,y-2) + (1 - \alpha - \beta)f(x-1,y-1) + \beta f(x-2,y)$$

has a significantly cleaner solution for $\alpha, \beta, 1-\alpha-\beta \in [0,1]$ for real $x$,  if one was to choose suitable boundary conditions. 

It turns out that this is the case. Taking inspiration from a recurrence relation that the [Beta function](https://en.wikipedia.org/wiki/Beta_function) exhibits, one can show that the function

$$f(x,y) = \int_{1}^{2}t^x \left(\frac{2 \beta t}{\sqrt{4 \beta t^2 - 4 \alpha \beta  + (1-\alpha-\beta)^2} - (1-\alpha - \beta)}\right)^y dt$$

solves the above recurrence relation.
